---
- name: create foodtrac system group
  group:
    name: foodtrac
- name: create foodtrac system user
  user:
    name: foodtrac
    group: foodtrac
- name: create foodtrac mysql database
  mysql_db:
    name: foodtrac_db
    state: present
#    TODO: fix credential setup, should not be committing password to repo
- name: create foodtrac mariadb database
  mysql_user:
    name: foodtrac
    password: '12345'
    priv: 'foodtrac_db.*:ALL'
    state: present
- name: Install git package
  apt:
    state: latest
    name: git
- name: checkout foodtrac code
  register: git_finished
  git:
    repo: 'https://github.com/hrla14-foodtrac/foodtrac.git'
    dest: /var/www/foodtrac
- name: install npm deps
  shell: npm install
  register: npm_finished
  failed_when: '"ERR!" in npm_finished.stderr'
  when: git_finished.changed
  args:
    chdir: /var/www/foodtrac
